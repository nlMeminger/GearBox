<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarPlay Dongle Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸš— CarPlay Dongle Manager</h1>
            <div id="connection-status" class="status disconnected">
                <span class="status-dot"></span>
                <span class="status-text">Server Disconnected</span>
            </div>
        </header>

        <main>
            <!-- Dongle Detection Section -->
            <section class="card">
                <h2>USB Dongle Detection</h2>
                <div id="dongle-status" class="status-box">
                    <p>No dongle detected</p>
                </div>
                <button id="detect-btn" class="btn btn-primary">Detect Carlinkit Dongle</button>
            </section>

            <!-- Device Information Section -->
            <section class="card" id="device-info-section" style="display: none;">
                <h2>Device Information</h2>
                <div id="device-info" class="info-box">
                    <!-- Device details will be populated here -->
                </div>
                <button id="disconnect-btn" class="btn btn-danger">Disconnect</button>
            </section>

            <!-- CarPlay Video Display Section -->
            <section class="card" id="carplay-section" style="display: none;">
                <h2>CarPlay Display</h2>
                <div class="video-container">
                    <video id="carplay-video" 
                           controls 
                           autoplay 
                           style="width: 100%; max-width: 1280px; background: #000;">
                    </video>
                </div>
                <div class="carplay-controls">
                    <button id="start-carplay-btn" class="btn btn-success">Start CarPlay</button>
                    <button id="stop-carplay-btn" class="btn btn-danger" style="display: none;">Stop CarPlay</button>
                </div>
            </section>

            <!-- Communication Section -->
            <section class="card" id="communication-section" style="display: none;">
                <h2>Send Commands</h2>
                <div class="command-controls">
                    <button class="btn btn-secondary" data-command="status">Get Status</button>
                    <button class="btn btn-secondary" data-command="home">Home</button>
                    <button class="btn btn-secondary" data-command="back">Back</button>
                    <button class="btn btn-secondary" data-command="frame">Request Frame</button>
                </div>
            </section>

            <!-- Log Section -->
            <section class="card">
                <h2>Activity Log</h2>
                <div id="log" class="log-box">
                    <p class="log-entry">Waiting for connection...</p>
                </div>
                <button id="clear-log-btn" class="btn btn-secondary btn-sm">Clear Log</button>
            </section>
        </main>
    </div>

    <!-- Include Socket.IO from CDN -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- Include jMuxer for H.264 video playback -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jmuxer@2.0.3/dist/jmuxer.min.js"></script>
    
    <!-- Include our custom scripts -->
    <script src="{{ url_for('static', filename='js/socket-handler.js') }}"></script>
    <script src="{{ url_for('static', filename='js/usb-handler.js') }}"></script>
    <script src="{{ url_for('static', filename='js/carplay-video-handler.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
